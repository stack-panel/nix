# Generated by stackpanel - edits will be overwritten
jobs:
  rekey:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Install Nix
      uses: cachix/install-nix-action@v30
    - name: Setup SSH key
      run: 'mkdir -p ~/.ssh

        echo "${{ secrets.AGENIX_SSH_KEY }}" > ~/.ssh/id_ed25519

        chmod 600 ~/.ssh/id_ed25519

        '
    - name: Install agenix
      run: nix profile install github:ryantm/agenix
    - name: Rekey
      run: cd secrets && agenix -r
    - name: Commit changes
      run: 'git config user.name "github-actions[bot]"

        git config user.email "github-actions[bot]@users.noreply.github.com"

        git diff --quiet secrets/*.age || (git add secrets/*.age && git commit -m
        "chore: rekey secrets" && git push)

        '
name: Rekey Secrets
'on':
  push:
    branches:
    - main
    paths:
    - secrets/secrets.nix
  workflow_dispatch: {}
permissions:
  contents: write

